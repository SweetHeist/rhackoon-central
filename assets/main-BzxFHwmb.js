import{c as b,l as Z,u as ee,a as te,i as se,b as G,t as ne,e as T,d as f,p as ie,f as C,g as oe,h as r,s as S,j as l,m as v,k as u,n as p,o as g,q as ae}from"./legacy-CCVVp6yd.js";function re(o){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function q(o){b===null&&re(),Z&&b.l!==null?le(b).m.push(o):ee(()=>{const e=te(o);if(typeof e=="function")return e})}function le(o){var e=o.l;return e.u??={a:[],b:[],m:[]}}class E{static Create(e,t,s,i,a,h=!1,c=!1){const w=window.open("/rhackoon-central/empty.html","_blank",`popup,width=${t},height=${s},left=${i},top=${a},fullscreen=${c?1:0}`);if(!w)return Promise.resolve(null);var y=new E(w,i||0,a||0,h);return y.Initialize(e)}constructor(e,t,s,i){this.#e=e,this.#n=t,this.#i=s,this.#c=i,this.#l=!1}Initialize(e){return this.#e.addEventListener("resize",t=>{this.OnWindowResized()}),this.#e.addEventListener("focus",()=>{this.#l=!0}),this.#e.addEventListener("blur",()=>{this.#l=!1}),new Promise(t=>{this.#e.addEventListener("load",()=>{setTimeout(()=>{const s=this.#e.document.createElement("script");s.innerText=`navigator.locks.request('${e}', lock => { self.close(); });`,this.#e.document.body.append(s),this.#t=this.#e.document.createElement("button"),"getScreenDetails"in this.#e&&this.#e.getScreenDetails().then(i=>{this.#d=i}).catch(i=>{}),this.#o=this.#n-this.GetDomWindow().screenX,this.#s=this.#i-this.GetDomWindow().screenY,this.#a=this.GetDomWindow().outerWidth,this.#r=this.GetDomWindow().outerHeight,this.UpdateMainElement(),t(this)},100)})})}GetMainElement(){return this.#t}GetDomWindow(){return this.#e}UpdateMainElement(){this.#t&&(this.#t.width=this.#e.innerWidth,this.#t.height=this.#e.innerHeight)}OnWindowResized(){this.#c?this.UpdateMainElement():!this.#a||!this.#r?(this.#a=this.GetDomWindow().outerWidth,this.#r=this.GetDomWindow().outerHeight,this.UpdateMainElement()):this.SetSize(this.#a,this.#r)}Update(e){if(this.IsFocused()){const t=e.InputManager(),s=t.IsKeyDown("a")?-1:t.IsKeyDown("d")?1:0,i=t.IsKeyDown("w")?-1:t.IsKeyDown("s")?1:0;(s||i)&&this.#e.moveBy(s*5,i*5)}}Sync(){this.#n=this.GetDomWindow().screenX+this.#o,this.#i=this.GetDomWindow().screenY+this.#s}SetSize(e,t){this.#e.resizeTo(e,t),this.UpdateMainElement()}GetX(){return this.#n}GetY(){return this.#i}GetWidth(){return this.#e.innerWidth}GetHeight(){return this.#e.innerHeight}Contains(e,t){return this.GetX()<=e&&e<=this.GetX()+this.GetWidth()&&this.GetY()<=t&&t<=this.GetY()+this.GetHeight()}IsFocused(){return this.#l}Focus(){this.#e.focus()}GetScreenDetails(){return this.#d}IsClosed(){return this.#e.closed}ShowToast(e,t){console.log(e);const s=this.GetDomWindow().document.getElementById("toast");s.classList.remove("fade-in-out"),s.classList.add("fade-in-out"),s.querySelector("h5").innerText=e,s.querySelector("p").innerText=t}SetTitle(e){this.GetDomWindow().document.querySelector("title").innerText=e}#e;#t;#o;#s;#a;#r;#n;#i;#c;#l;#d}class ce{constructor(){this.#t=new Array,this.#s=`game_window_lock-${Math.random()}`,navigator.locks.request(this.#s,e=>new Promise(()=>{}))}async Initialize(){this.#e()}AddWindow(e,t,s,i,a=!1,h=!1){const c=E.Create(this.#s,e,t,s,i,a,h);return c.then(w=>{w&&this.#t.push(w)}),c}GetWindows(){return this.#t}async#e(){try{return(await navigator.permissions.query({name:"window-management"})).state==="granted"}catch{return!1}}CycleFocus(e){const t=this.#t.length;if(t){for(let s=0;s<t;++s)if(this.#t[s].IsFocused()){this.#t[(s+e+t)%t].Focus();return}this.#t[0].Focus()}}#t;#o;#s}class m{static async GetScreenDetails(){if(m.#e===void 0)try{m.#e=await window.getScreenDetails()}catch{m.#e=null}return m.#e}static async GetMultiScreenBoundaries(){let e={top:window.screen.availTop,left:window.screen.availLeft,right:window.screen.availLeft+window.screen.availWidth,bottom:window.screen.availTop+window.screen.availHeight},t=await m.GetScreenDetails();if(t)for(const s of t.screens)e.top=Math.min(e.top,s.top),e.left=Math.min(e.left,s.left),e.right=Math.max(e.right,s.left+s.width),e.bottom=Math.max(e.bottom,s.top+s.height);return e.width=e.right-e.left,e.height=e.bottom-e.top,e}static#e=void 0}async function z(){const e=await fetch("./data/exampleLevel.json");if(!e.ok)throw new Error(e.statusText);return await e.json()}function L(o){const e=o.window;return{x:e.GetX(),y:e.GetY(),width:e.GetWidth(),height:e.GetHeight()}}function de(o,e){return!(o.x+o.width<=e.x||o.x>=e.x+e.width||o.y+o.height<=e.y||o.y>=e.y+e.height)}function he(o,e){const t=L(o),s=L(e);return de(t,s)}class ue{#e;#t;#o;#s;#a;#r;#n;#i=null;constructor(){this.#e=new ce}async Initialize(){await this.#e.Initialize()}async Start(){if(this.#n)throw new Error("Already running");this.#n=!0,this.#t=await m.GetScreenDetails(),this.#o=this.#t?.screens.find(e=>e!=this.#t.currentScreen)||window.screen,await this.openWindows()}async openWindows(){let e=await z();this.#s=new Array,e.windows.forEach(async t=>{this.#e.AddWindow(t.width,t.height,t.x,t.y,t.allow_resize,t.fullscreen).then(i=>{if(!i)return;const a={id:crypto.randomUUID(),window:i,state:{app:t.ui?.app??"panel",mode:t.ui?.mode??"single",role:t.ui?.role??"primary",terminalCommands:t.ui?.terminalCommands??null}};i.GetDomWindow().addEventListener("keydown",h=>{console.log(window)}),i.GetDomWindow().addEventListener("keyup",h=>{console.log(h)}),this.#s.push(a),this.sendStateToPopup(a)})})}syncPopups(){console.debug("SYNCING");for(const e of this.#s)e.window.Sync()}movePopups(){for(const e of this.#s)console.debug(e.window),e.window.GetDomWindow().moveTo(200,10)}setFocusedPopup(e){this.#i=e}clearFocusedPopup(){this.#i=null}sendStateToPopup(e){e.window.GetDomWindow().postMessage({type:"setState",payload:e.state},"*")}switchPopupToCombineByInternalId(e){const t=this.#s.find(s=>s.id===e);t&&(t.state={...t.state,app:"combine",mode:"merged"},this.sendStateToPopup(t))}switchPopupToCombineByOverlap(){console.debug(this.#s);const e=this.#s.find(s=>s.window.IsFocused()),t=this.#s.filter(s=>s!==e&&he(s,e));console.debug({overlapping:t});for(const s of t)s.state.app="combine",this.sendStateToPopup(s)}}var pe=C('<button class="secondary svelte-1n46o8q">Prompt multiscreen permission</button>'),we=C(`<main class="wrap svelte-1n46o8q"><h1>Sweet Heist</h1> <h2>rHACKoon Central</h2> <p>Play as stealthy Pedro and his hacker buddy Pascal as you solve your way through Grandma Jill's house to steal her prized cotton candy.</p> <p>A 2-player stealth puzzle made during the Global Gam Jam 2026. The two players work in separate locations and need to communicate verbally to help each other find out the code to grandma Jill's safe.</p> <section class="card svelte-1n46o8q"><h2><bold>Requirements</bold></h2> <div class="row svelte-1n46o8q"><strong>Chrome Browser:</strong> <span>Latest version required.</span></div> <div class="row svelte-1n46o8q"><strong>Popups permission:</strong> <span>Allow in settings (Check left to the URL > Site Settings > Popups & Redirects or popup alert upon start). There should be more than one popup upon start.</span></div> <h2><bold>Information</bold></h2> <div class="row svelte-1n46o8q"><strong>Status:</strong> <span> </span></div> <div class="row svelte-1n46o8q"><strong>Window Management:</strong> <span><!></span></div> <div class="row svelte-1n46o8q"><strong>Permission:</strong> <span> </span></div> <div class="row svelte-1n46o8q"><strong>Multiscreen:</strong> <span> </span></div> <!> <button class="svelte-1n46o8q"><!></button>  <p class="hint svelte-1n46o8q">Bugs are expected.</p></section></main>`);function me(o,e){oe(e,!1);let t,s=v(!1),i=v("Idle"),a=v(!1),h=v("unknown"),c=v("");async function w(){l(a,"getScreenDetails"in window);try{const n=await navigator.permissions.query({name:"window-management"});if(l(h,n.state),n.state==="granted"&&r(a))try{const d=await window.getScreenDetails();l(c,`Multiscreen (${d?.screens?.length??0} detected)`)}catch{l(c,"Multiscreen (details unavailable)")}else n.state==="prompt"?l(c,"Multiscreen (click to prompt)"):n.state==="denied"?l(c,"Multiscreen (permission denied)"):l(c,r(a)?"Multiscreen (unknown)":"Multiscreen (not supported)");n.addEventListener("change",()=>{w()})}catch{l(h,"unknown"),l(c,r(a)?"Multiscreen (permission API unavailable)":"Multiscreen (not supported)")}}async function y(){r(s)||(l(i,"Initializing…"),t=new ue,await t.Initialize(),l(i,"Starting…"),await t.Start(),l(s,!0),l(i,"Running"))}let W;q(async()=>{W=await z(),console.debug("FETCHED LEVEL",W)}),window.addEventListener("message",n=>{console.debug("[EVENT]: ",n),n.data?.type==="popupFocused"&&(t.setFocusedPopup(n.source),console.debug("FOCUSED pu: ",n.source)),n.data?.type==="popupBlurred"&&t.clearFocusedPopup(n.source),n.data?.type==="requestCombine"&&(console.debug("REQUESTCOMBINE--"),t.syncPopups(),t.switchPopupToCombineByOverlap())}),window.addEventListener("keydown",n=>{console.log(n.key)}),window.addEventListener("keyup",n=>{console.log(n.key)});async function F(){if(r(a))try{await window.getScreenDetails()}catch{}finally{await w()}}q(async()=>{await w()}),se();var D=we(),B=p(u(D),8),P=p(u(B),8),H=p(u(P),2),A=u(H),x=p(P,2),R=p(u(x),2),O=u(R);{var U=n=>{var d=g("supported");f(n,d)},Y=n=>{var d=g("not supported");f(n,d)};G(O,n=>{r(a)?n(U):n(Y,!1)})}var k=p(x,2),j=p(u(k),2),K=u(j),I=p(k,2),X=p(u(I),2),$=u(X),M=p(I,2);{var N=n=>{var d=pe();T("click",d,F),f(n,d)};G(M,n=>{r(a)&&r(h)==="prompt"&&n(N)})}var _=p(M,2),J=u(_);{var V=n=>{var d=g("Running…");f(n,d)},Q=n=>{var d=g("Start Hacking");f(n,d)};G(J,n=>{r(s)?n(V):n(Q,!1)})}ne(()=>{S(A,r(i)),S(K,r(h)),S($,r(c)),_.disabled=r(s)}),T("click",_,y),f(o,D),ie()}ae(me,{target:document.getElementById("app")});
